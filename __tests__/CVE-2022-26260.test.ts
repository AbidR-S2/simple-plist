import * as plist from "../src";

/**
 * @see https://github.com/advisories/GHSA-gff7-g5r8-mg8m
 * @see https://nvd.nist.gov/vuln/detail/CVE-2022-26260
 */

describe("CVE-2022-26260", () => {
  it("filters out unsafe properties", () => {
    const unsafeDoc = { __proto__: { length: 42 }, foo: "bar" };
    const safeDoc = plist.parse(plist.stringify(unsafeDoc));

    expect(safeDoc).toMatchInlineSnapshot(`
      Object {
        "foo": "bar",
      }
    `);
  });

  /**
   * @see https://security.snyk.io/vuln/SNYK-JS-SIMPLEPLIST-2413671
   */
  test("snyk POC", () => {
    var xmlPollution = `<plist version="1.0">
  <dict>
    <key>__proto__</key>
    <dict>
      <key>length</key>
      <string>polluted</string>
    </dict>
  </dict>
</plist>`;
    expect(() => plist.parse(xmlPollution)).toThrow();
  });
});
